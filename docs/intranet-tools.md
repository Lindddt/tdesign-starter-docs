# 内网基础设施

若您的网站运行在内网中（供员工/同事访问和使用），有些基础设施也许您可以用上。

## 智能网关：身份认证

它提供身份认证能力。网站接入它后，用户可使用 OA 快速登录（如下图）。

![iOA 登录页面](./static/images/ioa-login-webpage.png)

为帮助您快速接入，这里简单介绍一下它的工作原理。

### 公司内网网络

![智能网关架构图](./static/images/smart-proxy-arch.drawio.svg)

- 用户处于“办公网”；
- 您的网站服务器运行在“IDC 网“；
- 两个网络是隔开的；“智能网关”是互通的桥梁。

### 用户登录和身份认证

![用户登录和身份认证](./static/images/smart-proxy-login-process.drawio.svg)

1. **未登录**：用户首次访问您的网站时，请求需要经过智能网关。智能网关检查到用户未登录，**自动**重定向到登录页；
1. **登录中**：用户通过 OA 快速登录后，智能网关会生成登录态 cookie，存放到用户的浏览器中；
1. **已登录**：用户再次访问您的网站时，自动会带上登录态 cookie。智能网关检查到用户已登录，则将请求转发到您的网站，并在请求头中加上了请求签名（以防止伪造请求）和用户的企业微信名（您读取此字段即可知道当前的用户）等信息。

附注：

- 您只需参考下方链接接入智能网关，之后在网站服务器中校验签名即可。无需自研登录功能（即，上方“未登录”和“登录中”的阶段，智能网关均已实现）；
- 校验签名：在智能网关官网登记网站时，它会给您一个 Token。用该 Token 可校验签名的有效性，以防止伪造身份；
- 智能网关只提供身份认证能力，无鉴权能力。

### 参考

- [智能网关官网](https://paas.oa.com/)
- [智能网关接入指南](https://iwiki.woa.com/pages/viewpage.action?pageId=463573371)
- [通过智能网关获取用户信息和组织架构](https://iwiki.woa.com/pages/viewpage.action?pageId=717076960)
- [通过智能网关获取用户头像](https://iwiki.woa.com/pages/viewpage.action?pageId=546653110)

## 七彩石
